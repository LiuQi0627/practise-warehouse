<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.messi.system.order.mapper.OrderInfoMapper">

    <resultMap id="ResultMap" type="com.messi.system.order.domain.entity.OrderInfoDO">
        <id column="id" property="id"/>
        <result column="channel" property="channel"/>
        <result column="order_id" property="orderId"/>
        <result column="order_type" property="orderType"/>
        <result column="order_status" property="orderStatus"/>
        <result column="order_cancel_time" property="orderCancelTime"/>
        <result column="seller_id" property="sellerId"/>
        <result column="user_id" property="userId"/>
        <result column="total_amount" property="totalAmount"/>
        <result column="actual_amount" property="actualAmount"/>
        <result column="order_pay_type" property="orderPayType"/>
        <result column="pay_time" property="payTime"/>
        <result column="coupon_id" property="couponId"/>
        <result column="appraise_status" property="appraiseStatus"/>
        <result column="create_time" property="createTime"/>
        <result column="modified_time" property="modifiedTime"/>
    </resultMap>

    <sql id="column_list">
        id, channel, order_id, order_type, order_status, order_cancel_time, seller_id,user_id,total_amount,
actual_amount,order_pay_type,pay_time,coupon_id,appraise_status,create_time,modified_time
    </sql>

    <select id="queryOrderPageByJoinTable" parameterType="com.messi.system.order.domain.query.OrderQueryCondition"
            resultType="com.messi.system.order.domain.dto.OrderQueryDTO">
        SELECT o.order_id AS orderId,
        o.order_type AS orderType,
        o.order_status AS orderStatus,
        o.order_cancel_time AS orderCancelTime,
        o.seller_id AS sellerId,
        o.user_id AS userId,
        o.total_amount AS totalAmount,
        o.actual_amount AS actualAmount,
        o.order_pay_type AS orderPayType,
        o.pay_time AS payTime,
        o.coupon_id AS couponId,
        o.channel AS channel,
        o.appraise_status AS appraiseStatus,
        item.order_item_id AS orderItemId,
        item.product_id AS productId,
        item.sku_id AS skuId,
        item.sale_num AS saleNum,
        item.sale_price AS salePrice,
        price_details.order_item_price AS orderItemPrice,
        o.create_time AS createTime,
        o.modified_time AS modifiedTime
        FROM order_info AS o
        LEFT JOIN order_item_info AS item on o.order_id = item.order_id
        LEFT JOIN order_price_details AS price_details on o.order_id = price_details.order_id
        <where>
            <if test='query.orderStatuses != null and query.orderStatuses.size !=0'>
                <foreach collection='query.orderStatuses' item='orderStatus' open=' AND o.order_status in (' close=')'
                         separator=','>
                    #{orderStatus}
                </foreach>
            </if>
            <if test='query.sellerIds != null and query.sellerIds.size !=0'>
                <foreach collection='query.sellerIds' item='sellerId' open=' AND o.seller_id in (' close=')'
                         separator=','>
                    #{sellerId}
                </foreach>
            </if>
            <if test='query.userIds != null and query.userIds.size !=0'>
                <foreach collection='query.userIds' item='userId' open=' AND o.user_id in (' close=')' separator=','>
                    #{userId}
                </foreach>
            </if>
            <if test='query.orderPayTypes != null and query.orderPayTypes.size !=0'>
                <foreach collection='query.orderPayTypes' item='orderPayType' open=' AND o.order_pay_type in ('
                         close=')' separator=','>
                    #{orderPayType}
                </foreach>
            </if>
            <if test='query.appraiseStatuses != null and query.appraiseStatuses.size !=0'>
                <foreach collection='query.appraiseStatuses' item='appraiseStatus' open=' AND o.appraise_status in ('
                         close=')' separator=','>
                    #{appraiseStatus}
                </foreach>
            </if>
        </where>
        ORDER BY o.create_time DESC

    </select>


</mapper>
